
<!DOCTYPE doctype html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="ie=edge" http-equiv="x-ua-compatible"/>
<meta content="Guide for openstack-ansible Deployers" name="description"/>
<link href="https://ostackdoc.github.io/prepare-deployment-host/" rel="canonical"/>
<meta content="Chinthaka Deshapriya" name="author"/>
<meta content="Copy to clipboard" name="lang:clipboard.copy"/>
<meta content="Copied to clipboard" name="lang:clipboard.copied"/>
<meta content="en" name="lang:search.language"/>
<meta content="True" name="lang:search.pipeline.stopwords"/>
<meta content="True" name="lang:search.pipeline.trimmer"/>
<meta content="No matching documents" name="lang:search.result.none"/>
<meta content="1 matching document" name="lang:search.result.one"/>
<meta content="# matching documents" name="lang:search.result.other"/>
<meta content="[\s\-]+" name="lang:search.tokenizer"/>
<link href="../assets/images/favicon.png" rel="shortcut icon"/>
<meta content="mkdocs-1.0.4, mkdocs-material-4.0.2" name="generator"/>
<title>Prepare Deployment Host - Openstack Ansible Deployment Guide</title>
<link href="../assets/stylesheets/application.982221ab.css" rel="stylesheet"/>
<link href="../assets/stylesheets/application-palette.224b79ff.css" rel="stylesheet"/>
<meta content="#3f51b5" name="theme-color"/>
<script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono" rel="stylesheet"/>
<style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
<link href="../assets/fonts/material-icons.css" rel="stylesheet"/>
<link href="../manifest.webmanifest" rel="manifest"/>
<link href="../extra.css" rel="stylesheet"/>
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-136248088-1", "ostackdoc.github.io")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" dir="ltr">
<svg class="md-svg">
<defs>
<svg height="448" id="__github" viewbox="0 0 416 448" width="416" xmlns="http://www.w3.org/2000/svg">
<path d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" fill="currentColor"></path>
</svg>
</defs>
</svg>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<a class="md-skip" href="#configuring_the_operating_system" tabindex="1">
        Skip to content
      </a>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a class="md-header-nav__button md-logo" href="https://ostackdoc.github.io" title="Openstack Ansible Deployment Guide">
<i class="md-icon"></i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
              Openstack Ansible Deployment Guide
            </span>
<span class="md-header-nav__topic">
              Prepare Deployment Host
            </span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/ostackdoc/ostackdoc-docs/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#__github"></use>
</svg>
</div>
<div class="md-source__repository">
    ostackdoc/ostackdoc-docs
  </div>
</a>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title md-nav__title--site" for="__drawer">
<a class="md-nav__button md-logo" href="https://ostackdoc.github.io" title="Openstack Ansible Deployment Guide">
<i class="md-icon"></i>
</a>
    Openstack Ansible Deployment Guide
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-source="github" href="https://github.com/ostackdoc/ostackdoc-docs/" title="Go to repository">
<div class="md-source__icon">
<svg height="24" viewbox="0 0 24 24" width="24">
<use height="24" width="24" xlink:href="#__github"></use>
</svg>
</div>
<div class="md-source__repository">
    ostackdoc/ostackdoc-docs
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href=".." title="Introduction">
      Introduction
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../overview/" title="Overview">
      Overview
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../network-architectures/" title="Network Architectures">
      Network Architectures
    </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-toggle md-nav__toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
        Prepare Deployment Host
      </label>
<a class="md-nav__link md-nav__link--active" href="./" title="Prepare Deployment Host">
      Prepare Deployment Host
    </a>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#configuring_the_operating_system" title="Configuring the Operating System">
    Configuring the Operating System
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#install_the_operating_system" title="Install the Operating System">
    Install the Operating System
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#alternative_ubuntu_server_installer" title="Alternative Ubuntu Server installer">
    Alternative Ubuntu Server installer
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configure_the_network_interfaces" title="Configure The Network  Interfaces.">
    Configure The Network  Interfaces.
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#changing_netplan_to_ifupdown" title="Changing netplan to ifupdown">
    Changing netplan to ifupdown
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consistent_naming_for_network_interfaces" title="Consistent Naming for Network Interfaces">
    Consistent Naming for Network Interfaces
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#assigning_ip_addresses" title="Assigning IP Addresses">
    Assigning IP Addresses
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../prepare-the-target-hosts/" title="Prepare the Target Hosts">
      Prepare the Target Hosts
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../test-env-example/" title="Test Environment Example">
      Test Environment Example
    </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" id="nav-7" type="checkbox"/>
<label class="md-nav__link" for="nav-7">
      Preparing OpenStack Nodes
    </label>
<nav class="md-nav" data-md-component="collapsible" data-md-level="1">
<label class="md-nav__title" for="nav-7">
        Preparing OpenStack Nodes
      </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../install-node-os/" title="Installing Node OS">
      Installing Node OS
    </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configure-node-network/" title="Configuring Node Network">
      Configuring Node Network
    </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#configuring_the_operating_system" title="Configuring the Operating System">
    Configuring the Operating System
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#install_the_operating_system" title="Install the Operating System">
    Install the Operating System
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#alternative_ubuntu_server_installer" title="Alternative Ubuntu Server installer">
    Alternative Ubuntu Server installer
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configure_the_network_interfaces" title="Configure The Network  Interfaces.">
    Configure The Network  Interfaces.
  </a>
<nav class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#changing_netplan_to_ifupdown" title="Changing netplan to ifupdown">
    Changing netplan to ifupdown
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consistent_naming_for_network_interfaces" title="Consistent Naming for Network Interfaces">
    Consistent Naming for Network Interfaces
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#assigning_ip_addresses" title="Assigning IP Addresses">
    Assigning IP Addresses
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset"><a class="md-icon md-content__icon" download href="prepare-deployment-host.pdf" title="PDF Export"></a>
<a class="md-icon md-content__icon" href="https://github.com/ostackdoc/ostackdoc-docs/edit/master/docs/prepare-deployment-host.md" title="Edit this page"></a>
<h1>Prepare Deployment Host</h1>
<p><img alt="" src="../img/prepare-deployment-host.jpg"/></p>
<p>In this section we are going to discuss how we are going to prepare OpenStack-Ansible host. This is the host that will hold the OpenStack-Ansible playbook Repository and deployment configurations.</p>
<p>Since this guide has been prepared using <strong>Ubuntu Linux 18.04 LTS</strong> operating systems you will not find the instructions on configuring other supported operating systems for OpenStack-Ansible. Please refer to the respective configurations manuals of those operating systems and adjust a particular configuration that suits your needs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you install OpenStack in a production environment, we recommend using a separate deployment host that contains Ansible and orchestrates the OpenStack-Ansible (OSA) installation on the target hosts.</p>
<p>In a test environment, we recommend using one of the infrastructure target hosts as the deployment host.</p>
</div>
<p>To use a target host as a deployment host, follow the steps in <a href="/prepare-the-target-hosts/">Prepare the target hosts</a> on the deployment host.</p>
<h2 id="configuring_the_operating_system">Configuring the Operating System<a class="headerlink" href="#configuring_the_operating_system" title="Permanent link">¶</a></h2>
<p>This section covers how to install and configure <strong>Ubuntu 18.04 LTS Serer</strong> in our OpenStack-Ansible host.</p>
<h3 id="install_the_operating_system">Install the Operating System<a class="headerlink" href="#install_the_operating_system" title="Permanent link">¶</a></h3>
<p>If your have downloaded your Ubuntu server image download the installation ISO from alternate download section.</p>
<h4 id="alternative_ubuntu_server_installer">Alternative Ubuntu Server installer<a class="headerlink" href="#alternative_ubuntu_server_installer" title="Permanent link">¶</a></h4>
<p>Since we  require advanced networking and storage features such as; LVM, RAID, multipath, vlans, bonds, or re-using existing partitions, you will want to continue to use the alternate installer.</p>
<p><a href="http://cdimage.ubuntu.com/releases/18.04.2/release/ubuntu-18.04.2-server-amd64.iso">Download the alternate installer</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We do not cover on how to install the Ubuntu server here. We assume that you already know howto do it.</p>
</div>
<h4 id="configure_the_network_interfaces">Configure The Network  Interfaces.<a class="headerlink" href="#configure_the_network_interfaces" title="Permanent link">¶</a></h4>
<p>We assume that your OpenStack Ansible host has two network interface cards. We are planning our network like below</p>
<p><strong>1.</strong> Configure one network card for accessing the Internet</p>
<div class="codehilite"><pre><span></span>Network: 192.168.10.0/24
</pre></div>
<p><strong>2.</strong> Configure the other network card for accessing our OpenStack deployment management network.</p>
<div class="codehilite"><pre><span></span>Network: 172.29.236.0/24
</pre></div>
<h5 id="changing_netplan_to_ifupdown">Changing <code>netplan</code> to <code>ifupdown</code><a class="headerlink" href="#changing_netplan_to_ifupdown" title="Permanent link">¶</a></h5>
<p>The classic <code>ifupdown</code> network configuration used in Debian/Ubuntu  has been replaced by <code>netplan</code> on Ubuntu 18.04 server system.</p>
<p>You can view the current <code>netplan</code> configuration using  the command below. You may have a different name for your <code>YML</code> as per your installation environment.</p>
<div class="codehilite"><pre><span></span>cat /etc/netplan/01-netcfg.yaml
</pre></div>
<p>You will get an output like below.</p>
<div class="codehilite"><pre><span></span># This file describes the network interfaces available on your system
# For more information, see netplan(5).
network:
  version: 2
  renderer: networkd
  ethernets:
    enp0s3:
      dhcp4: yes
</pre></div>
<p>To re-enable <code>ifupdown</code> on this system, run:</p>
<div class="codehilite"><pre><span></span>sudo apt install ifupdown
</pre></div>
<h5 id="consistent_naming_for_network_interfaces">Consistent Naming for Network Interfaces<a class="headerlink" href="#consistent_naming_for_network_interfaces" title="Permanent link">¶</a></h5>
<p>New versions of Linux Kernel, including the one in our Ubuntu server name the network interfaces using a new convention based on the network interface type (PCI, PCIe, Onboard, Wireless, etc.,) and the relative position of the motherboard which we have slotted the specific card. For example, you may get interface names like <code>enp0s3, eno1, p2p1</code> etc. While this is an advantageous in many cases as it provides consist ant name of each interface during our OpenStack-Ansible deployment we are going to rename them back to our traditional naming convention <code>eth0, eth1</code>, and so on.</p>
<p>To get back to <code>ethX</code> again will do the following configurations</p>
<div class="codehilite"><pre><span></span>sudo nano /etc/default/grub
</pre></div>
<p>Look for <code>GRUB_CMDLINE_LINUX</code>  and add the following <code>net.ifnames=0 biosdevname=0</code>.</p>
<p><strong>From:</strong></p>
<div class="codehilite"><pre><span></span>GRUB_CMDLINE_LINUX=""
</pre></div>
<p><strong>To:</strong></p>
<div class="codehilite"><pre><span></span>GRUB_CMDLINE_LINUX="net.ifnames=0 biosdevname=0"
</pre></div>
<p>Generate a new grub file using the following command.</p>
<div class="codehilite"><pre><span></span>sudo grub-mkconfig -o /boot/grub/grub.cfg
</pre></div>
<p>Now reboot your systems</p>
<div class="codehilite"><pre><span></span>sudo systemctl reboot
</pre></div>
<p>Now check your interface name:</p>
<div class="codehilite"><pre><span></span>ip link show
</pre></div>
<p>You should get an output like below:</p>
<div class="codehilite"><pre><span></span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 08:00:27:cb:31:f1 brd ff:ff:ff:ff:ff:ff
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 08:00:27:b4:05:38 brd ff:ff:ff:ff:ff:ff
</pre></div>
<h5 id="assigning_ip_addresses">Assigning IP Addresses<a class="headerlink" href="#assigning_ip_addresses" title="Permanent link">¶</a></h5>
<p>Use the following sample configuration  your network.</p>
<div class="codehilite"><pre><span></span>sudo nano /etc/network/interfaces

Add the following configurations
</pre></div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a class="md-flex md-footer-nav__link md-footer-nav__link--prev" href="../network-architectures/" rel="prev" title="Network Architectures">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Previous
                </span>
                Network Architectures
              </span>
</div>
</a>
<a class="md-flex md-footer-nav__link md-footer-nav__link--next" href="../prepare-the-target-hosts/" rel="next" title="Prepare the Target Hosts">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
                  Next
                </span>
                Prepare the Target Hosts
              </span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            Copyright © 2018 - 2019 Chinthaka Deshapriya
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
</div>
<div class="md-footer-social">
<link href="../assets/fonts/font-awesome.css" rel="stylesheet"/>
<a class="md-footer-social__link fa fa-github" href="https://github.com/ostackdoc"></a>
<a class="md-footer-social__link fa fa-twitter" href="https://twitter.com/ostackdoc"></a>
<a class="md-footer-social__link fa fa-linkedin" href="https://linkedin.com/in/ostackdoc"></a>
</div>
</div>
</div>
</footer>
</div>
<script src="../assets/javascripts/application.d9aa80ab.js"></script>
<script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
</body>
</html>